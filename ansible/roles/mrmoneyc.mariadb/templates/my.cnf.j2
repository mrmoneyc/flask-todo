# {{ ansible_managed }}

[client]
port                            = {{ mariadb_cfg_mysqld_port }}
socket                          = {{ mariadb_cfg_mysqld_socket }}

[mysqld_safe]
socket		                = {{ mariadb_cfg_mysqld_safe_socket }}
nice		                = {{ mariadb_cfg_mysqld_safe_nice }}

[mysqld]
port                            = {{ mariadb_cfg_mysqld_port }}
socket                          = {{ mariadb_cfg_mysqld_socket }}
pid-file	                = {{ mariadb_cfg_mysqld_pid_file }}
basedir		                = {{ mariadb_cfg_mysqld_basedir }}
datadir		                = {{ mariadb_cfg_mysqld_datadir }}
tmpdir		                = {{ mariadb_cfg_mysqld_tmpdir }}
{% if mariadb_cfg_mysqld_skip_external_locking -%}
skip-external-locking
{% endif %}

bind_address                    = {{ mariadb_cfg_mysqld_bind_address }}
performance_schema              = {{ mariadb_cfg_mysqld_performance_schema }}

{% if mariadb_cfg_mysqld_skip_name_resolve -%}
skip-name-resolve
{% endif %}
max_connections                 = {{ mariadb_cfg_mysqld_max_connections }}
connect_timeout                 = {{ mariadb_cfg_mysqld_connect_timeout }}
max_allowed_packet              = {{ mariadb_cfg_mysqld_max_allowed_packet }}
wait_timeout		        = {{ mariadb_cfg_mysqld_wait_timeout }}
thread_cache_size               = {{ mariadb_cfg_mysqld_thread_cache_size }}
sort_buffer_size	        = {{ mariadb_cfg_mysqld_sort_buffer_size }}
bulk_insert_buffer_size	        = {{ mariadb_cfg_mysqld_bulk_insert_buffer_size }}

default_storage_engine	        = {{ mariadb_cfg_mysqld_default_storage_engine }}
innodb_buffer_pool_size	        = {{ mariadb_cfg_mysqld_innodb_buffer_pool_size }}
innodb_log_buffer_size	        = {{ mariadb_cfg_mysqld_innodb_log_buffer_size }}
innodb_file_per_table	        = {{ mariadb_cfg_mysqld_innodb_file_per_table }}
innodb_open_files	        = {{ mariadb_cfg_mysqld_innodb_open_files }}
innodb_io_capacity	        = {{ mariadb_cfg_mysqld_innodb_io_capacity }}
innodb_flush_method	        = {{ mariadb_cfg_mysqld_innodb_flush_method }}
innodb_flush_log_at_trx_commit  = {{ mariadb_cfg_mysqld_innodb_flush_log_at_trx_commit }}

innodb_buffer_pool_instances    = {{ mariadb_cfg_mysqld_innodb_buffer_pool_instances }}
innodb_buffer_pool_size         = {{ mariadb_cfg_mysqld_innodb_buffer_pool_size }}
innodb_log_file_size            = {{ mariadb_cfg_mysqld_innodb_log_file_size }}
table_cache                     = {{ mariadb_cfg_mysqld_table_cache }}

tmp_table_size                  = {{ mariadb_cfg_mysqld_tmp_table_size }}
max_heap_table_size             = {{ mariadb_cfg_mysqld_max_heap_table_size }}

query_cache_type                = {{ mariadb_cfg_mysqld_query_cache_type }}
query_cache_limit               = {{ mariadb_cfg_mysqld_query_cache_limit }}
query_cache_size                = {{ mariadb_cfg_mysqld_query_cache_size }}
query_cache_min_res_unit        = {{ mariadb_cfg_mysqld_query_cache_min_res_unit }}

join_buffer_size                = {{ mariadb_cfg_mysqld_join_buffer_size }}
sort_buffer_size                = {{ mariadb_cfg_mysqld_sort_buffer_size }}
read_buffer_size                = {{ mariadb_cfg_mysqld_read_buffer_size }}
read_rnd_buffer_size            = {{ mariadb_cfg_mysqld_read_rnd_buffer_size }}
key_buffer_size                 = {{ mariadb_cfg_mysqld_key_buffer_size }}

{% if mariadb_cfg_mysqld_general_log == "ON" -%}
general-log                     = {{ mariadb_cfg_mysqld_general_log}}
general-log-file                = {{ mariadb_cfg_mysqld_general_log_file}}
{% endif %}


{% if mariadb_is_prod -%}
slow_query_log                  = {{ mariadb_cfg_mysqld_slow_query_log }}
slow_query_log_file	        = {{ mariadb_cfg_mysqld_slow_query_log_file }}
long_query_time                 = {{ mariadb_cfg_mysqld_long_query_time }}
log_slow_admin_statements       = {{ mariadb_cfg_mysqld_log_slow_admin_statements }}
log_queries_not_using_indexes   = {{ mariadb_cfg_mysqld_log_queries_not_using_indexes }}
{% endif %}


server-id		        = {{ mariadb_server_id }}
log_bin                         = {{ mariadb_cfg_mysqld_log_bin }}
expire_logs_days	        = {{ mariadb_cfg_mysqld_expire_logs_days }}
max_binlog_size                 = {{ mariadb_cfg_mysqld_max_binlog_size }}
log-slave-updates               = {{ mariadb_cfg_mysqld_log_slave_updates }}

{% if mariadb_is_master -%}
sync_binlog                     = {{ mariadb_cfg_mysqld_sync_binlog }}
{% else %}
read_only                       = 1
{% endif %}

[mysqld_multi]
mysqld                          = {{ mariadb_cfg_mysqld_multi_mysqld }}
mysqladmin                      = {{ mariadb_cfg_mysqld_multi_mysqladmin }}
log                             = {{ mariadb_cfg_mysqld_multi_log }}

[mysqldump]
quick                           = {{ mariadb_cfg_mysqldump_quick }}
quote-names                     = {{ mariadb_cfg_mysqldump_quote_names }}
max_allowed_packet	        = {{ mariadb_cfg_mysqldump_max_allowed_packet }}
